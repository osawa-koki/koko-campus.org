<h1>C10K問題とnginx</h1>
<a href="https://w3techs.com/blog/entry/nginx_is_now_the_most_popular_web_server_overtaking_apache">Q-Success</a>の報告によると、2021年の5月のwebサーバの市場シェアでnginxがapacheを上回ったと報告しました。<br /><br />理由は多数存在しますが、nginxが克服しているC10K問題をapacheが克服できていないことがあげられます。<br />ということで、まずはC10K問題について説明します。<br /><br />C10K問題とは「C」(client)が「10K」(10,000)を超えると、サーバのハードウェア性能には問題がないのにも関わらず、実行効率が急激に低下する問題です。<br /><br />大切なのは「サーバのハードウェアの性能には問題がない」という点です。<br /><br />では、何が問題なのでしょうか???<br /><br />答えは、以下の2つです。
<ul>
	<li>プロセス数の上限</li>
	<li>コンテキストスイッチにかかる処理</li>
</ul>
<h2>プロセス数の上限</h2>
第一にOS内で実行されるプロセスには全てプロセスIDが割り当てられます。<br />一般的なwebサーバ用のosであるlinuxでは32,767が上限です。<br /><br />このため、1つのリクエストに1つのプロセスを生成する方法では、この上限が発生します。<br /><br />これに関してはlinuxを32ビット型から2<sup>22</sup>まで生成可能な64ビット型にアップデートすることで対応可能です。
<h2>コンテキストスイッチにかかる処理</h2>
一般にC10K問題というと、こちらを指すことが多いです。<br />1つのCPUが複数のプロセスを並行処理する際に、処理するプロセスを切り替える際にかかる処理が膨れ上がることによって処理性能に問題が出ます。<br /><br />これに関してはシングルプロセス・シングルスレッドでリクエストを処理することで解決できます。<br />また、これを実現するwebサーバがnginxです。
<div class="separator"></div>
<h2>nginx</h2>
以前はLAMP(linux Apache Mysql,MariaDB PHP,Perl,Python)によってサーバを構築することが主流でしたが、Apacheがこれほど大きな問題を克服できていない以上、apacheからnginxへの以降はもはや必至と言えます。<br />nginx以外にもCloudflareServerやLiteSpeedなども代替案として考えられますが、特に理由がない場合は安定してシェアを伸ばしているnginxを選択するべきと言えるでしょう。