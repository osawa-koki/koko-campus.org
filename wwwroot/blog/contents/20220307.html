<h1>apacheのインデックスファイルへのアクセスとリライト機能</h1>
インデックスファイルへのアクセスに関する挙動について知らなかったことがあったのでメモ。<br />以下で説明する内容はapacheのデフォルト設定を想定しています。<br /><br />結論として、リライト機能を使用して拡張子を省略可能に設定する際には「ファイル名と同一名のディレクトリを作成するべきではない」と言えます。<br /><br />これに関しては前提知識が必要ですので、まずは以下の二点を説明します。
<ul>
	<li>インデックスファイル</li>
	<li>リライト機能</li>
</ul>
<h2>インデックスファイル</h2>
最初に、ディレクトリインデックスファイルについて説明します。<br />ディレクトリインデックスファイルとはディレクトリに対するアクセスがあった際にデフォルトで表示するファイルのことを言います。<br />例えば、「dir」ディレクトリに「index.html」「file1.html」「file2.html」「file3.html」の4つのファイルが保存されているとします。<br /><br />この時、「〇〇〇/dir/index.html」とすれば、当然「index.html」ファイルにアクセス可能です。<br />「〇〇〇/dir/file1.html」とすれば、当然「file1.html」へのアクセスが可能です。<br /><br />では、「〇〇〇/dir/」とディレクトリにアクセスした場合はどうなるでしょうか???<br /><br />答えは、「index.html」にアクセスされます。<br /><br />このようにディレクトリを代表するファイルをディレクトリインデックスファイルと言います。<br /><br />因みに、「.htaccess」ファイルで「index.html」以外に変更することも可能です。
<code class="-dot-htaccess">
	DirectoryIndex top.html
</code>
上のように設定した場合にはディレクトリに対してのアクセスには当該ディレクトリ内の「top.html」へアクセスされます。
<h2>リライト機能</h2>
受け取ったhttpリクエストの対象urlを書き換える(rewrite)機能です。<br />一般的には拡張子を隠すために使用されます。<br /><br />例えば、「index.html」に対するアクセスを「index」だけでok!とする機能です。
<code class="-dot-htaccess">
	&lt;IfModule mod_rewrite.c&gt;
		RewriteEngine On
		RewriteCond %{REQUEST_FILENAME}\.html -f
		RewriteRule ^(.+)$ $1\.html
	&lt;/IfModule&gt;
</code>
これでok!です。
<div class="separator"></div>
混同しがちですが、最後に「/」が付いた場合にはディレクトリへのアクセスとなり、ディレクトリインデックスファイルが設定されている場合にはそれに対してアクセスされます。<br /><br />最後に「/」がない場合にはファイルに対するアクセスとなり、リライト機能によって拡張子が不要なファイルに対してアクセスされます。<br /><br />ただ、実際には少し変な挙動になっています。<br /><br />「/」がなくても「/」があるとみなされてリダイレクトされたり、、、<br /><br />まず第一に、ディレクトリがある場合にはそちらが優先されます。
<img src="data/20220307(0).gif" alt="インデックスファイルとリライト機能の関係" />
「dir」ファイルへのアクセスなのに対して、「dir」ディレクトリのインデックスファイルへのアクセスへと変換されています。<br /><br />では、「dir」ディレクトリを削除してみましょう♪
<img src="data/20220307(1).gif" alt="インデックスファイルとリライト機能の関係" />
これで、「dir」ファイルへのアクセス(拡張子の省略)となりました。<br /><br />ファイル名とディレクトリ名が衝突しても通常は問題ありません。<br />しかしながら、リライト機能を使用して拡張子を省略可能とした場合には、両者の衝突によって思わぬバグにつながる危険性があります。<br />避けましょう♪
<script src="../package/js-modules/koko-code/ver1.js" charset="utf-8" defer></script>